(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{475:function(t,s,a){"use strict";a.r(s);var n=a(34),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"语法高亮"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法高亮"}},[t._v("#")]),t._v(" 语法高亮")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("语法高亮决定源代码的颜色和样式，它主要负责关键字（如javascript中的"),a("code",[t._v("if")]),t._v("，"),a("code",[t._v("for")]),t._v("）、字符串、注释、变量名等等语法的着色工作。")]),t._v(" "),a("p",[t._v("语法高亮由两部分工作组成：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%88%86%E8%AF%8D"}},[t._v("分词")]),t._v("：将文本分割为一系列符号（包括单词和标点）")]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B8%BB%E9%A2%98%E5%8C%96"}},[t._v("主题化")]),t._v("：然后根据主题或用户设置，对符号进行着色添加样式")])]),t._v(" "),a("p",[t._v("在本章开始之前，建议你先玩一下 "),a("a",{attrs:{href:"#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%A3%80%E6%9F%A5%E5%99%A8"}},[t._v("作用域检查器")]),t._v(" 工具看看文件中的符号都长什么样子，他们都应用了哪些主题样式。用内置主题（比如 Dark+）查看一份 TypeScript 文件，你就能同时看到语义高亮和语法高亮了。")]),t._v(" "),a("h2",{attrs:{id:"分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词"}},[t._v("#")]),t._v(" 分词")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("文本分词是指将文本打碎成一个个片段，并将每个片段根据符号类型（单词、标点等）进行分类。")]),t._v(" "),a("p",[t._v("VS Code 的分词引擎是通过 "),a("a",{attrs:{href:"https://macromates.com/manual/en/language_grammars",target:"_blank",rel:"noopener noreferrer"}},[t._v("TextMate"),a("OutboundLink")],1),t._v(" 驱动的。TextMate 语法是一套使用 plist(XML) 或 JSON 格式的结构化正则表达式集合。VS Code 则可通过 "),a("code",[t._v("grammar")]),t._v(" 配置点进行语法配置。")]),t._v(" "),a("p",[t._v("TextMate 分词引擎和渲染引擎在同一个进程上运行，用户输入时，对应的"),a("strong",[t._v("符号")]),t._v("也会实时更新。"),a("strong",[t._v("符号")]),t._v("是语法高亮的最小单位，它将代码分为注释、字符串、正则等类型。")]),t._v(" "),a("p",[t._v("从1.43 版本开始，VS Code 也允许插件通过 "),a("a",{attrs:{href:"https://code.visualstudio.com/api/references/vscode-api#DocumentSemanticTokensProvider",target:"_blank",rel:"noopener noreferrer"}},[t._v("语义化分词供应器函数"),a("OutboundLink")],1),t._v(" 提供分词功能。语义供应器函数通常由语言服务器实现，它必须能够深入理解源代码，并且能够解析上下文的各类符号。比如，一个常量的名称应该在整个项目中都使用常量类型的语法高亮，而不是只在它声明的地方。")]),t._v(" "),a("p",[t._v("基于语义化分词的语法高亮，一般被认为是基于 TextMate 语言高亮的一个补充。语义化高亮是语法高亮的上层建筑。由于语言服务器通常都要花不少时间加载和分析项目，所以语义化高亮展现也可能会有所延迟。")]),t._v(" "),a("p",[t._v("本章侧重于介绍基于 TextMate 的分词和语法高亮，语义化分词高亮请查看"),a("a",{attrs:{href:"/language-extensions/semantic-highlight-guide"}},[t._v("语义高亮")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"textmate-语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#textmate-语法"}},[t._v("#")]),t._v(" TextMate 语法")]),t._v(" "),a("p",[t._v("VS Code使用"),a("a",{attrs:{href:"https://macromates.com/manual/en/language_grammars",target:"_blank",rel:"noopener noreferrer"}},[t._v("TextMate 语法"),a("OutboundLink")],1),t._v("将文本分割成一个个符号。TextMate语法是"),a("a",{attrs:{href:"https://macromates.com/manual/en/regular_expressions",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oniguruma正则表达式"),a("OutboundLink")],1),t._v("的集合，一般是一份plist或者JSON格式的文件。你可以在"),a("a",{attrs:{href:"https://www.apeth.com/nonblog/stories/textmatebundle.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1),t._v("找到更棒的介绍文档，在里面可以找到你感兴趣的TextMate语法。")]),t._v(" "),a("h4",{attrs:{id:"textmate符号和作用域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#textmate符号和作用域"}},[t._v("#")]),t._v(" TextMate符号和作用域")]),t._v(" "),a("p",[a("strong",[t._v("符号")]),t._v("是由一门编程语言中最常见的一到几个字符组成的。符号包括运算符（如："),a("code",[t._v("+")]),t._v("和"),a("code",[t._v("*")]),t._v("），变量名（如："),a("code",[t._v("myVar")]),t._v("），或者字符串（如："),a("code",[t._v('"my string"')]),t._v("）。")]),t._v(" "),a("p",[t._v("每个"),a("strong",[t._v("符号")]),t._v("都有其作用域，作用域描述了这个"),a("strong",[t._v("符号")]),t._v("的上下文。一个"),a("strong",[t._v("符号")]),t._v("可被由"),a("strong",[t._v("点")]),t._v("符号序列查找到，比如javascript中的"),a("code",[t._v("+")]),t._v("符号有这样的作用域"),a("code",[t._v("keyword.operator.arithmetic.js")]),t._v("。")]),t._v(" "),a("p",[t._v("主题会把颜色和样式映射到作用域上，这样一来就实现了语法高亮。TextMate提供了一些主题中"),a("a",{attrs:{href:"https://macromates.com/manual/en/language_grammars",target:"_blank",rel:"noopener noreferrer"}},[t._v("常用的作用域"),a("OutboundLink")],1),t._v("，如果你想要尽可能全面地支持语法，最好从现成的主题中入手，避免重新编写主题。")]),t._v(" "),a("p",[a("strong",[t._v("作用域")]),t._v("支持嵌套，每个符号都会关联到它的父作用域上。下面的例子使用了"),a("a",{attrs:{href:"#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%A3%80%E6%9F%A5%E5%99%A8"}},[t._v("作用域检查器")]),t._v("，可以清晰地看到javascript函数中的运算符"),a("code",[t._v("+")]),t._v("和它的作用域层级：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/scopes.png",alt:"scopes"}})]),t._v(" "),a("p",[t._v("父作用域的信息也同样是主题中的一部分。当主题指定了作用域，该作用域下的所有符号都会进行对应的着色，除非主题里面对单个作用域有其特殊配置。")]),t._v(" "),a("h3",{attrs:{id:"配置基本语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置基本语法"}},[t._v("#")]),t._v(" 配置基本语法")]),t._v(" "),a("p",[t._v("VS Code支持JSON格式的TextMate语法。你可以在"),a("a",{attrs:{href:"/references/contribution-points"}},[t._v("发布内容配置")]),t._v("里面的"),a("code",[t._v("grammers")]),t._v("进行配置。")]),t._v(" "),a("p",[t._v("这个配置点可以配置的内容有：语言的id，顶层语法作用域的名称，语法文件的路径。下面是一个"),a("code",[t._v("abc")]),t._v("语言的语法配置文件：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contributes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"languages"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"extensions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grammars"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"language"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./syntaxes/abc.tmGrammar.json"')]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("p",[t._v("这个语法文件本身包含了一个顶层规则，里面一般分为两个部分，"),a("code",[t._v("patterns")]),t._v("列出了程序(program)和"),a("code",[t._v("repository")]),t._v("的顶层元素。语法中的其他规则需要从"),a("code",[t._v("repository")]),t._v("中使用"),a("code",[t._v('{ "include": "#id" }')]),t._v("引入。")]),t._v(" "),a("p",[a("code",[t._v("abc")]),t._v("语法标记了字母"),a("code",[t._v("a")]),t._v("，"),a("code",[t._v("b")]),t._v("和"),a("code",[t._v("c")]),t._v("作为关键字，可以被括号包起来成为一个表达式。")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"patterns"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"include"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#expression"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"repository"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expression"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"patterns"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"include"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#letter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"include"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#paren-expression"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"letter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a|b|c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword.letter"')]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"paren-expression"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"begin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\("')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"end"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"beginCaptures"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"0"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"punctuation.paren.open"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"endCaptures"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"0"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"punctuation.paren.close"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"expression.group"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"patterns"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"include"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#expression"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br")])]),a("p",[t._v("语法引擎会试着逐步将"),a("code",[t._v("expression")]),t._v("中的规则应用到文本中。比如下面这个简单的程序：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("a\n(\n    b\n)\nx\n(\n    (\n        c\n        xyz\n    )\n)\n(\na\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("这个例子中的语法产生了下面的作用域列表（从左到右，从最佳匹配到最不匹配）")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("a               keyword.letter, source.abc\n(               punctuation.paren.open, expression.group, source.abc\n    b           expression.group, source.abc\n)               punctuation.paren.close, expression.group, source.abc\nx               source.abc\n(               punctuation.paren.open, expression.group, source.abc\n    (           punctuation.paren.open, expression.group, expression.group, source.abc\n        c       keyword.letter, expression.group, expression.group, source.abc\n        xyz     expression.group, expression.group, source.abc\n    )           punctuation.paren.close, expression.group, expression.group, source.abc\n)               punctuation.paren.close, expression.group, source.abc\n(               source.abc\na               keyword.letter, source.abc\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("注意文本匹配不是单一规则，比如字符串"),a("code",[t._v("xyz")]),t._v("，是包含在当前作用域中的。文件的最后一个括号在"),a("code",[t._v("expression.group")]),t._v("里面，因为不会匹配"),a("code",[t._v("end")]),t._v("规则。")]),t._v(" "),a("h3",{attrs:{id:"嵌入式语言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#嵌入式语言"}},[t._v("#")]),t._v(" 嵌入式语言")]),t._v(" "),a("p",[t._v("如果你的语法中需要在父语言中嵌入其他语言，比如HTML中的CSS，那么你可以使用"),a("code",[t._v("embeddedLanguages")]),t._v("配置，告诉VSCode怎么处理嵌入的语言。然后嵌入语言的括号匹配，注释，和其他基础语言功能都会正常运作。")]),t._v(" "),a("p",[a("code",[t._v("embeddedLanguages")]),t._v("配置将嵌入语言的作用域映射到顶层语言的作用域上。下面里的例子里，"),a("code",[t._v("meta.embedded.block.javascript")]),t._v("作用域中的任何符号都会以javscript处理：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contributes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grammars"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./syntaxes/abc.tmLanguage.json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"embeddedLanguages"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"meta.embedded.block.javascript"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.js"')]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("现在，如你对应用了"),a("code",[t._v("meta.embedded.block.javascript")]),t._v("的符号进行注释就会有正确的"),a("code",[t._v("//")]),t._v("javascript风格，如果你触发代码片段，也会提示对应的javascript片段。")]),t._v(" "),a("h3",{attrs:{id:"开发全新的语法插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发全新的语法插件"}},[t._v("#")]),t._v(" 开发全新的语法插件")]),t._v(" "),a("p",[t._v("使用"),a("a",{attrs:{href:"/get-started/your-first-extension"}},[t._v("VS Code的Yeoman模板")]),t._v("快速创建一个新的语法插件，运行"),a("code",[t._v("yo code")]),t._v("然后选择"),a("code",[t._v("New Language")]),t._v("：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yo-new-language.png",alt:"yo-new-language"}})]),t._v(" "),a("p",[t._v("Yeoman通过问问题的方式最后生成新的插件，对于创建语法插件最重要的几点就是：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Language Id")]),t._v(" - 这个语言的id")]),t._v(" "),a("li",[a("code",[t._v("Language Name")]),t._v(" - 友好的名称")]),t._v(" "),a("li",[a("code",[t._v("Scope names")]),t._v(" - TextMate根作用域名称")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yo-new-language-questions.png",alt:"yo-new-language-questions"}})]),t._v(" "),a("p",[t._v("生成器会假设你要同时对新语言定义好语言id和语法。如果你只是根据已有的语言创建新的语法，那么你只要填好目标语言的信息就好，然后一定要删除生成的"),a("code",[t._v("package.json")]),t._v("中的"),a("code",[t._v("languages")]),t._v("部分。")]),t._v(" "),a("p",[t._v("回答了一大堆问题之后，Yeoman会创建一个新的插件，其结构如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/generated-new-language-extension.png",alt:"generated-new-language-extension"}})]),t._v(" "),a("p",[t._v("!> 注意：如果你只是配置一个VS Code中已有语言的语法，记得删掉生成的"),a("code",[t._v("package.json")]),t._v("中的"),a("code",[t._v("languages")]),t._v("配置。")]),t._v(" "),a("h4",{attrs:{id:"迁移现成的textmate语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移现成的textmate语法"}},[t._v("#")]),t._v(" 迁移现成的TextMate语法")]),t._v(" "),a("p",[a("code",[t._v("yo code")]),t._v("也快成帮你把已有的TextMate语法转成一个VS Code插件。使用"),a("code",[t._v("yo code")]),t._v("，选择"),a("code",[t._v("Language extension")]),t._v("，当询问是否从已有TextMate文件插件的时候，填入后缀为"),a("code",[t._v(".tmLanguage")]),t._v("或"),a("code",[t._v(".json")]),t._v("的TextMate语法文件。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yo-convert.png",alt:"yo-convert"}})]),t._v(" "),a("h4",{attrs:{id:"用yaml配置语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用yaml配置语法"}},[t._v("#")]),t._v(" 用YAML配置语法")]),t._v(" "),a("p",[t._v("随着语言日益复杂，你可能很快就会难以理解和维护你的json文件。如果你发现自己需要写很多正则表达式，或是需要添加大量解释语法层面的注释，你可能需要考虑使用yaml定义语法文件了。")]),t._v(" "),a("p",[t._v("Yaml语法和json有着同样的结构，但是它的语法更加精简，如多行字符串和注释。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yaml-grammar.png",alt:"yaml-grammar"}})]),t._v(" "),a("p",[t._v("VS Code只能加载json语法，所以yaml格式的语法文件必须最终转换成json文件。"),a("a",{attrs:{href:"https://www.npmjs.com/package/js-yaml",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("js-yaml")]),t._v("包"),a("OutboundLink")],1),t._v("可以帮你完成这个任务：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Install js-yaml as a development only dependency in your extension")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" js-yaml --save-dev\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Use the command line tool to convert the yaml grammar to json")]),t._v("\n$ npx js-yaml syntaxes/abc.tmLanguage.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" syntaxes/abc.tmLanguage.json\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h4",{attrs:{id:"语法注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法注入"}},[t._v("#")]),t._v(" 语法注入")]),t._v(" "),a("p",[t._v("你可以通过"),a("em",[t._v("语法注入")]),t._v("扩展一个现成的语法文件。"),a("em",[t._v("语法注入")]),t._v("就是常规的TextMate语法，"),a("em",[t._v("语法注入")]),t._v("的应用有：")]),t._v(" "),a("ul",[a("li",[t._v("高亮注释中的关键字，如"),a("code",[t._v("TODO")])]),t._v(" "),a("li",[t._v("对现有语法添加更明确的作用域信息")]),t._v(" "),a("li",[t._v("向Markdown中的代码区块添加语法高亮")])]),t._v(" "),a("p",[a("strong",[t._v("创建一个基础语法注入")])]),t._v(" "),a("p",[a("em",[t._v("语法注入")]),t._v("也是在"),a("code",[t._v("package.json")]),t._v("中配置的，不过这次不需要配置"),a("code",[t._v("language")]),t._v("，而是配置"),a("code",[t._v("injectTo")]),t._v("指明目需要注入的语言作用域列表。")]),t._v(" "),a("p",[t._v("在这个例子里，我们会新建一个非常简单的注入语法，对javascript注释中的"),a("code",[t._v("TODO")]),t._v("进行高亮。我们在"),a("code",[t._v("injectTo")]),t._v("中用"),a("code",[t._v("source.js")]),t._v("指向目标语言的作用域。")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contributes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grammars"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./syntaxes/injection.json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"todo-comment.injection"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"injectTo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("除了顶层的"),a("code",[t._v("injectionSelector")]),t._v("，语法本身就应该是标准的TextMate语法。"),a("code",[t._v("injectionSelector")]),t._v("是一个作用域选择器，它指明了"),a("em",[t._v("语法注入")]),t._v("生效的作用域。在我们的例子里，我们想要在所有"),a("code",[t._v("//")]),t._v("注释中的"),a("code",[t._v("TODO")]),t._v("高亮。使用"),a("a",{attrs:{href:"#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%A3%80%E6%9F%A5%E5%99%A8"}},[t._v("作用域检查器")]),t._v("，我们会发现JavaScript的双斜杠存在作用域"),a("code",[t._v("comment.line.double-slash")]),t._v("，所以我们的注入选择器是"),a("code",[t._v("L:comment.line.double-slash")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"todo-comment.injection"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"injectionSelector"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"L:comment.line.double-slash"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"patterns"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"include"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#todo-keyword"')]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"repository"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"todo-keyword"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TODO"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword.todo"')]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("注入选择器中的"),a("code",[t._v("L:")]),t._v("代表注入的语法添加在现有语法规则的左边。也就是说我们注入的语法规则会在任何现有语法规则之前生效。")]),t._v(" "),a("p",[a("strong",[t._v("嵌入语法")])]),t._v(" "),a("p",[a("em",[t._v("语法注入")]),t._v("也可以用在嵌入语言中，在他们的父级语法中进行配置。就和普通的语法意义，"),a("em",[t._v("语法注入")]),t._v("也可以使用"),a("code",[t._v("embeddedLanguages")]),t._v("将嵌入语言的作用域映射到顶层的语言作用域上。")]),t._v(" "),a("p",[t._v("比如高亮JS字符串中的sql查询的插件，可以使用"),a("code",[t._v("embeddedLanguages")]),t._v("为字符串中所有匹配"),a("code",[t._v("meta.embedded.inline.sql")]),t._v("的符号应用sql语言的基本功能，比如括号匹配和片段选择。")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contributes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grammars"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./syntaxes/injection.json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sql-string.injection"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"injectTo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"embeddedLanguages"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"meta.embedded.inline.sql"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.sql"')]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[a("strong",[t._v("符号类型和嵌入语言")])]),t._v(" "),a("p",[t._v("对于嵌入语言中的注入语言还会有个副作用，那就是VS Code把所有字符串（string）中的"),a("em",[t._v("符号")]),t._v("视为字符文本，而且把注释中的所有"),a("em",[t._v("符号")]),t._v("视为符号内容（token content）。\n因此诸如括号匹配和自动补全在字符串和注释中是无法使用的，如果"),a("em",[t._v("嵌入语言")]),t._v("刚好出现在字符串或注释中，那么这些功能就无法在"),a("em",[t._v("嵌入语言")]),t._v("中使用。")]),t._v(" "),a("p",[t._v("想要重载这个行为，你需要使用"),a("code",[t._v("meta.embedded.*")]),t._v("作用域重置VS Code标记字符串和注释行为。最佳实践就是始终将嵌入语言放在"),a("code",[t._v("meta.embedded.*")]),t._v("作用域中，确保VS Code能够正确处理嵌入语言。")]),t._v(" "),a("p",[t._v("如果你无法为你的语法添加"),a("code",[t._v("meta.embedded.*")]),t._v("作用域，你可以在语法配置中用"),a("code",[t._v("tokenTypes")]),t._v("，指定"),a("em",[t._v("作用域")]),t._v("到内容模式（content mode）上。\n下面的"),a("code",[t._v("tokenTypes")]),t._v("确保"),a("code",[t._v("my.sql.template.string")]),t._v("作用域中的任何内容都应视为代码：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contributes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grammars"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./syntaxes/injection.json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sql-string.injection"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"injectTo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"embeddedLanguages"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"my.sql.template.string"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source.sql"')]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tokenTypes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"my.sql.template.string"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"other"')]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("h2",{attrs:{id:"主题化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主题化"}},[t._v("#")]),t._v(" 主题化")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("主题化是把颜色和样式应用到"),a("strong",[t._v("符号")]),t._v("的过程。色彩主题定义了主题化规则，但用户可以在"),a("em",[t._v("用户设置")]),t._v("中自定义主题化规则。")]),t._v(" "),a("p",[a("code",[t._v("tokenColors")]),t._v(" 定义了 TextMate 主题规则，它的语法和常用的 TextMate 主题是完全一样的。每份规则都定义了 TextMate 作用域选择器，并应用对应的颜色和样式。")]),t._v(" "),a("p",[t._v("解析符号的颜色或样式时，当前符号的"),a("strong",[t._v("作用域")]),t._v("需要和规则中的"),a("strong",[t._v("选择器")]),t._v("相匹配，然后找到最为匹配的样式属性（前景色、加粗、斜体、下划线）。")]),t._v(" "),a("p",[a("a",{attrs:{href:"/extension-guides/color-theme"}},[t._v("色彩主题")]),t._v(" 章节介绍了如何创建新的色彩主题，语义化分词的主题化则在"),a("a",{attrs:{href:"/language-extensions/semantic-highlight-guide"}},[t._v("语义高亮")]),t._v("中。")]),t._v(" "),a("h2",{attrs:{id:"作用域检查器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作用域检查器"}},[t._v("#")]),t._v(" 作用域检查器")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("VS Code自带的作用域检查器能帮你调试语法文件。它能显示当前位置"),a("em",[t._v("符号")]),t._v("作用域，以及应用在上面的主题规则和元信息。")]),t._v(" "),a("p",[t._v("在命令面板中输入"),a("code",[t._v("Developer: Inspect TM Scopes")]),t._v("或者"),a("a",{attrs:{href:"https://code.visualstudio.com/docs/getstarted/keybindings",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用快捷键"),a("OutboundLink")],1),t._v("启动"),a("em",[t._v("作用域检查器")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cmd+alt+shift+i"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"command"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"editor.action.inspectTMScopes"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/scope-inspector.png",alt:"scope-inspector"}})]),t._v(" "),a("p",[t._v("作用域检查器可以显示以下的信息：")]),t._v(" "),a("ol",[a("li",[t._v("当前符号")]),t._v(" "),a("li",[t._v("关于符号的元信息，这些值都是计算后的值。如果你使用了嵌入语言，那么这里最重要的信息就是"),a("code",[t._v("language")]),t._v("和"),a("code",[t._v("token type")]),t._v("了")]),t._v(" "),a("li",[t._v("符号使用的主题规则。这里只显示当前应用的规则，而不显示被其他样式覆盖的规则。")]),t._v(" "),a("li",[t._v("完整的作用域列表，越往上作用域越明确。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);